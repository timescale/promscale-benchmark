# Apply your stack customization here. This file is not tracked by git.

# If you want to make persistent changes to this file you can do so by using
# `git update-index --no-assume-unchanged stack/values-overrides.yaml` command,
# commiting changes, and then disabling file tracking by running
# `git update-index --assume-unchanged stack/values-overrides.yaml` command.

# Configuration options are documented at:
# https://github.com/timescale/helm-charts/blob/main/charts/timescaledb-single/values.yaml
timescaledb-single:
  image:
    # Image was built from
    # https://github.com/timescale/timescaledb-docker-ha
    # http://docker.io/antekresic/timescaledb-ha:pg14-ts-main-merge-chunks
    # docker pull antekresic/timescaledb-ha:pg14-ts-rel-2.9.0
    # repository: antekresic/timescaledb-ha
    # repository: cevian/timescaledb-ha
    # repository: ararunprasad/timescaledb-ha
    # tag: pg14.5-ts2.8.1-p1
    # tag: pg14-ts-main-merge-chunks
    # tag: pg14-ts-rel-2.9.0
    # tag: pg14-ts-rel-2.9.0-fix
    # tag: ts2.9-prom3531b7
    # tag: ts-2.9.0-extension-master-0
    pullPolicy: Always

  resources:
    requests:
      cpu: "8"
      memory: 32Gi
  persistentVolumes:
    data:
      size: 1Ti
      storageClass: gp3
    wal:
      size: 200Gi
      storageClass: gp3
  service:
    primary:
      type: LoadBalancer
  patroni:
    bootstrap:
      dcs:
        postgresql:
          parameters:
            checkpoint_timeout: 15min
            checkpoint_completion_target: 0.9
            bgwriter_delay: 200ms
            bgwriter_lru_maxpages: 100
            bgwriter_flush_after: 512kB
            # bgwriter_lru_multiplier: 1
            # stats_temp_directory: /dev/shm/pg_stat_temp
            stats_temp_directory: pg_stat_temp
            shared_buffers: 45GB
            # autovacuum_max_workers: 1
            wal_compression: on
            max_wal_size: 180GB # for 240K samples/sec
            synchronous_commit: off
            pg_stat_statements.track: all
            # log_min_messages: DEBUG1
            # archive_mode: off
            # track_io_timing: on
            # timescaledb.max_open_chunks_per_insert: 429

# Configuration options are documented at:
# https://github.com/timescale/helm-charts/blob/main/charts/promscale/values.yaml
promscale:
  extraEnv: []
  resources:
    requests:
      memory: 16Gi
      cpu: "4"
  image:
    # repository: docker.io/ararunprasad/promscale
    # tag: 0.17.0-dev4
    pullPolicy: Always
  config:
    telemetry.log.level: debug
    # vacuum.parallelism: 1
    startup.upgrade-prerelease-extensions: true
      # metrics.cache.series.initial-size: 500000
    startup.dataset.config: |
      metrics:
        default_chunk_interval: 8h

kube-prometheus-stack:
  prometheusOperator:
    admissionWebhooks:
      enabled: false
  prometheus:
    prometheusSpec:
      remoteWriteDashboards: true
      retention: 30d
  grafana:
    env:
      GF_SNAPSHOTS_EXTERNAL_ENABLED: true
      GF_AUTH_ANONYMOUS_ENABLED: true
      GF_AUTH_ANONYMOUS_ORG_ROLE: "Admin"
    service:
      type: LoadBalancer

opentelemetry-operator:
  enabled: false
